<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <title>确认登录 - KLPBBS问卷</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://api.damesck.net/api/bootstrap-5.3.0-alpha1-dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://api.damesck.net/api/bootstrap-5.3.0-alpha1-dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="/js/utils/cookieUtil.js"></script>
    <style>
        a.ex {
            color: darkgray;
        }

        /* 设置图片为圆形并调整大小 */
        img.rounded-circle {
            border-radius: 50%;
            width: 130px; /* 你可以根据需要调整大小 */
            height: 130px;
            object-fit: cover; /* 确保图片按比例缩放且覆盖整个圆形 */
        }
    </style>
</head>
<body>
<div class="sticky-top shadow mb-2" style="background-color:rgba(255,255,255,0.95)">
    <div class="container">
        <header class="d-flex flex-wrap pt-2 pb-2">
            <span class="fs-4 me-auto"><i class="fa fa-paper-plane text-primary" aria-hidden="true"></i>&nbsp;确认登录 - KLPBBS问卷</span>
            <a href="" class="btn btn-outline-success"><i class="fa fa-home"></i> 返回首页</a>
        </header>
    </div>
</div>
<br>
<div class="container mt-3 d-flex justify-content-center">
    <script>
        let token = getCookie("token");
        console.log(token);

        let myHeaders = new Headers();
        myHeaders.append("token", token);

        let requestOptions = {
            method: 'GET',
            headers: myHeaders,
            redirect: 'follow'
        };

        fetch("https://wj.klpbbs.cn/api/user", requestOptions)
            .then(response => response.text())
            .then(result => {
                let user = JSON.parse(result);
                let user_id = user["uid"];
                let username = user["username"];
                let id_str = user_id.padStart(9, '0');
                let avatar_url = `https://user.klpbbs.com/data/avatar/${id_str.substring(0, 3)}/${id_str.substring(3, 5)}/${id_str.substring(5, 7)}/${id_str.substring(7, 9)}_avatar_big.jpg`

                document.getElementById("user_id").text = user_id;
                document.getElementById("username").text = username;
                document.getElementById("avatar").src = avatar_url;
            })
            .catch(error => console.log('error', error));

        function quit() {
            clearCookie("token");
            window.location.href = "/access";
        }
    </script>

    <div class="card" style="width: 18rem;">
        <!-- 添加 'rounded-circle' 类以将图片变为圆形并调整大小 -->
        <br>
        <img src="https://user.klpbbs.com/data/avatar/001/67/72/08_avatar_big.jpg" id="avatar" class="card-img-top rounded-circle mx-auto d-block" alt="">
        <div class="card-body text-center">
            <h5 class="card-title">确认这是你</h5>
            <p class="card-text">UID：<a id="user_id"></a> <br> 用户名：<a id="username"></a></p>
            <a href="#" class="btn btn-outline-success"><i class="fa fa-check"></i> 开始问卷</a>
            <br><br>
            <a class="ex" onclick="quit()">这不是你？重新登陆</a>
        </div>
    </div>
</div>
<div class="container mt-3">
    <p>
        Copyright
        <a href="https://klpbbs.com">
            KLPBBS
        </a>
        And
        <a href="https://github.com/TeamVastsea">
            TeamVastsea
        </a>
    </p>
</div>
</body>
</html>
